---
- name: Read the properties file
  slurp:
    src: "{{file_path}}"
  register: file_content_raw

- name: Decode content
  set_fact:
    file_content: "{{ file_content_raw['content'] | b64decode }}"

- name: Extract value for specific property
  set_fact:
    value_string: "{{ file_content | regex_search(property + '=([^\n]*)', '\\1') | first }}"

- name: Make a list of values for our property
  set_fact:
    values: "{{ value_string.split(',') }}"

- name: Check if all expected values are present
  assert:
    that:
      - "item in values"
    fail_msg: "Value '{{ item }}' not found for the key '{{ property }}'"
    success_msg: "Value '{{ item }}' found for the key '{{ property }}'"
  loop: "{{ expected_values }}"
