---
### SR Automation Workflow Test Environment Preparation - OAuth + RBAC
### Includes base preparation and adds OAuth + RBAC specific setup

- import_playbook: ../oauth.yml

- name: Download OAuth IDP cert
  hosts: localhost
  tasks:
    - shell: openssl s_client -showcerts -connect localhost:8443 </dev/null 2>/dev/null|openssl x509 -outform PEM > oauthcertfile.pem

- name: Configure IPv6 Preference
  import_playbook: ../configure_ipv6.yml

- name: Setup VM DNS
  import_playbook: ../dns.yml

- import_playbook: ../certificates.yml
  when: ssl_enabled | default(false)

- name: Setup Mock CC Cluster First (Standard Groups)
  import_playbook: confluent.platform.all
