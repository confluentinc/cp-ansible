---
### SR Automation Workflow Verification - Plaintext/No Auth
### Imports base verification and adds plaintext-specific checks

- import_playbook: ../base_templates/sr_automation_verify_base.yml

- name: Plaintext-Specific Verification
  hosts: schema_registry
  gather_facts: false
  tasks:
    - name: Verify HTTP-only communication
      uri:
        url: "http://{{ inventory_hostname }}:{{ schema_registry_listener_port }}/subjects"
        method: GET
        status_code: 200
      register: http_check
      tags: plaintext

    - name: Ensure HTTPS is not configured
      uri:
        url: "https://{{ inventory_hostname }}:{{ schema_registry_listener_port }}/subjects"
        method: GET
        status_code: 200
      register: https_check
      failed_when: false
      ignore_errors: true
      tags: plaintext

    - name: Verify plaintext-only access
      assert:
        that:
          - http_check is succeeded
          - https_check is failed or https_check.status != 200
        fail_msg: "Plaintext scenario should only allow HTTP access"
      tags: plaintext

    - name: Display plaintext scenario verification summary
      debug:
        msg: |
          âœ“ Plaintext SR Automation Verification Complete:
          - HTTP communication: {{ 'WORKING' if http_check is succeeded else 'FAILED' }}
          - HTTPS disabled: {{ 'CONFIRMED' if (https_check is failed or https_check.status != 200) else 'FAILED' }}
          - Security level: No authentication/encryption
          - Automation features: Functional in plaintext mode
      tags: plaintext
