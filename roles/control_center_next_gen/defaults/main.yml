---
# More control_center_next_gen variables are defined in the variables role

### Boolean to reconfigure Control Center Next Gen's logging with RollingFileAppender and log cleanup
control_center_next_gen_custom_log4j2: "{{ custom_log4j2 }}"

### Root logger level within Control Center Next Gen's log4j2 config. Only honored if control_center_next_gen_custom_log4j2: true
control_center_next_gen_log4j2_root_logger_level: "INFO"

### Root logger appender within Control Center Next Gen's log4j2 config. Only honored if control_center_next_gen_custom_log4j2: true
control_center_next_gen_log4j2_root_appenders:
  - Main

### Max number of log files generated by Control Center Next Gen. Only honored if control_center_next_gen_custom_log4j2: true
control_center_next_gen_max_log_files: 10

### Max size of a log file generated by Control Center Next Gen. Only honored if control_center_next_gen_custom_log4j2: true
control_center_next_gen_log_file_size: 100MB

### List of loggers to redact. This is specified alongside the user defined redactor name and appenderRefs to be used in redactor definition. The redactor name should be unique for each logger.
control_center_next_gen_logredactor_logger_specs_list:
  - { logger_name: "Root", appenderRefs: "Main" }

control_center_next_gen_oauth_urls_list: "{{ [oauth_token_uri, oauth_jwks_uri] | select('!=', 'none') | join(',') }}"

control_center_next_gen_oauth_urls_java_arg: "{% if not whitelist_explicit_oauth_urls|bool %}-Dorg.apache.kafka.sasl.oauthbearer.allowed.urls=*{% else %}-Dorg.apache.kafka.sasl.oauthbearer.allowed.urls={{control_center_next_gen_oauth_urls_list}}{% endif %}"

control_center_next_gen_java_args:
  - "{% if control_center_next_gen_ssl_enabled|bool %}-Djdk.tls.ephemeralDHKeySize=2048{% endif %}"
  - "{% if control_center_next_gen_authentication_type == 'basic' %}-Djava.security.auth.login.config={{control_center_next_gen.jaas_file}}{% endif %}"
  - "{% if kerberos_client_config_file_dest != '/etc/krb5.conf' %}-Djava.security.krb5.conf={{kerberos_client_config_file_dest}}{% endif %}"
  - "{%  if control_center_next_gen_oauth_urls_list != '' %}{{ control_center_next_gen_oauth_urls_java_arg }}{% endif %}"

### Custom Java Args to add to the Control Center Next Gen Process
control_center_next_gen_custom_java_args: ""

control_center_next_gen_final_java_args: "{{ control_center_next_gen_java_args + [ control_center_next_gen_custom_java_args ] }}"

### Full Path to the RocksDB Data Directory. If left as empty string, cp-ansible will not configure RocksDB
control_center_next_gen_rocksdb_path: ""

### Directory path to archive config files. This is used to determine the path to the config files for Control Center Next Gen dependencies.
control_center_next_gen_dependency_archive_config_file_path: "{{confluent_control_center_next_gen_binary_base_path}}{{ config_prefix }}/confluent-control-center"

### Directory path to rpm config files. This is used to determine the path to the config files for Control Center Next Gen dependencies.
control_center_next_gen_dependency_rpm_config_file_path: "{{ config_prefix }}/confluent-control-center"

control_center_next_gen_dependency_prometheus_generated_src_config_file: "{% if installation_method == 'archive' %}{{ control_center_next_gen_dependency_archive_config_file_path }}/prometheus-generated.yml{% else %}{{ control_center_next_gen_dependency_rpm_config_file_path }}/prometheus-generated.yml{% endif %}"
control_center_next_gen_dependency_recording_rules_generated_src_config_file: "{% if installation_method == 'archive' %}{{ control_center_next_gen_dependency_archive_config_file_path }}/recording_rules-generated.yml{% else %}{{ control_center_next_gen_dependency_rpm_config_file_path }}/recording_rules-generated.yml{% endif %}"
control_center_next_gen_dependency_trigger_rules_generated_src_config_file: "{% if installation_method == 'archive' %}{{ control_center_next_gen_dependency_archive_config_file_path }}/trigger_rules-generated.yml{% else %}{{ control_center_next_gen_dependency_rpm_config_file_path }}/trigger_rules-generated.yml{% endif %}"
control_center_next_gen_dependency_web_config_prom_src_config_file: "{% if installation_method == 'archive' %}{{ control_center_next_gen_dependency_archive_config_file_path }}/web-config-prom.yml{% else %}{{ control_center_next_gen_dependency_rpm_config_file_path }}/web-config-prom.yml{% endif %}"
# Path to custom Prometheus overlay config (optional)
control_center_next_gen_dependency_prometheus_custom_overlay_path: "{% if installation_method == 'archive' %}{{ control_center_next_gen_dependency_archive_config_file_path }}/prometheus-generated-overlay.yml{% else %}{{ control_center_next_gen_dependency_rpm_config_file_path }}/prometheus-generated-overlay.yml{% endif %}"

control_center_next_gen_dependency_alertmanager_generated_src_config_file: "{% if installation_method == 'archive' %}{{ control_center_next_gen_dependency_archive_config_file_path }}/alertmanager-generated.yml{% else %}{{ control_center_next_gen_dependency_rpm_config_file_path }}/alertmanager-generated.yml{% endif %}"
control_center_next_gen_dependency_web_config_am_src_config_file: "{% if installation_method == 'archive' %}{{ control_center_next_gen_dependency_archive_config_file_path }}/web-config-am.yml{% else %}{{ control_center_next_gen_dependency_rpm_config_file_path }}/web-config-am.yml{% endif %}"
# For following dictionaries, Key/Value Pairs with empty values will not be written into override.conf

### Overrides to the Service Section of Control Center Next Gen Systemd File. This variable is a dictionary.
control_center_next_gen_service_overrides:
  User: "{{ control_center_next_gen_user if control_center_next_gen_user != control_center_next_gen_default_user else '' }}"
  Group: "{{ control_center_next_gen_group if control_center_next_gen_group != control_center_next_gen_default_group else '' }}"
  ExecStart: "{% if installation_method == 'archive' %}{{ control_center_next_gen.server_start_file }} {{ control_center_next_gen.config_file }}{% endif %}"

### Overrides to the Service Section of Prometheus Control Center Next Gen Systemd File. This variable is a dictionary.
control_center_next_gen_dependency_prometheus_service_overrides:
  User: "{{ control_center_next_gen_user if control_center_next_gen_user != control_center_next_gen_default_user else '' }}"
  Group: "{{ control_center_next_gen_group if control_center_next_gen_group != control_center_next_gen_default_group else '' }}"
  ExecStart: "{{ control_center_next_gen_dep_prometheus.server_start_file }} {{ control_center_next_gen_dep_prometheus.config_file }}"

### Overrides to the Service Section of AlertManager Control Center Next Gen Systemd File. This variable is a dictionary.
control_center_next_gen_dependency_alertmanager_service_overrides:
  User: "{{ control_center_next_gen_user if control_center_next_gen_user != control_center_next_gen_default_user else '' }}"
  Group: "{{ control_center_next_gen_group if control_center_next_gen_group != control_center_next_gen_default_group else '' }}"
  ExecStart: "{{ control_center_next_gen_dep_alertmanager.server_start_file }} {{ control_center_next_gen_dep_alertmanager.config_file }}"

### Environment Variables to be added to the Control Center Next Gen Service. This variable is a dictionary.
control_center_next_gen_service_environment_overrides:
  ROCKSDB_SHAREDLIB_DIR: "{{control_center_next_gen_rocksdb_path}}"
  CONTROL_CENTER_HEAP_OPTS: "-Xmx6g"
  CONTROL_CENTER_OPTS: "{{ control_center_next_gen_final_java_args | confluent.platform.java_arg_build_out }}"
  CONTROL_CENTER_LOG4J_OPTS: "{% if control_center_next_gen_custom_log4j2|bool %}-Dlog4j2.configurationFile=file:{{control_center_next_gen.log4j_file}}{% endif %}"
  # Remove trailing slash if there is one
  LOG_DIR: "{{ control_center_next_gen_log_dir|regex_replace('\\/$', '') }}"
  CONFLUENT_SECURITY_MASTER_KEY: "{% if control_center_next_gen_secrets_protection_enabled|bool %}{{secrets_protection_masterkey}}{% endif %}"

### Environment Variables to be added to the Prometheus (Control Center Next Gen's dependency) Service. This variable is a dictionary.
control_center_next_gen_dependency_prometheus_service_environment_overrides:
  CONFIG_PATH: "{{ control_center_next_gen_dep_prometheus.config_path }}"
  # Data path environment variable is different between prometheus and alertmanager
  TSDB_PATH: "{{ control_center_next_gen_dep_prometheus.data_path }}"
  LOG_PATH: "{{ control_center_next_gen_dep_prometheus.log_path }}"
  PROMETHEUS_HOST: "{{ control_center_next_gen_dep_prometheus.prometheus_web_listener_host }}"
  PROMETHEUS_PORT: "{{ control_center_next_gen_dep_prometheus.prometheus_port }}"

### Environment Variables to be added to the AlertManager (Control Center Next Gen's dependency) Service. This variable is a dictionary.
control_center_next_gen_dependency_alertmanager_service_environment_overrides:
  CONFIG_PATH: "{{ control_center_next_gen_dep_alertmanager.config_path }}"
  DATA_PATH: "{{ control_center_next_gen_dep_alertmanager.data_path }}"
  LOG_PATH: "{{ control_center_next_gen_dep_alertmanager.log_path }}"
  ALERTMANAGER_HOST: "{{ control_center_next_gen_dep_alertmanager.alertmanager_web_listener_host }}"
  ALERTMANAGER_PORT: "{{ control_center_next_gen_dep_alertmanager.alertmanager_port }}"

### Overrides to the Unit Section of Control Center Next Gen Systemd File. This variable is a dictionary.
control_center_next_gen_service_unit_overrides:

### Overrides to the Unit Section of Prometheus Systemd File. This variable is a dictionary.
control_center_next_gen_dependency_prometheus_service_unit_overrides:

### Overrides to the Unit Section of Alert Manager Systemd File. This variable is a dictionary.
control_center_next_gen_dependency_alertmanager_service_unit_overrides:

### Time in seconds to wait before starting Control Center Next Gen Health Checks.
control_center_next_gen_health_check_delay: 30

control_center_next_gen_secrets_protection_file: "{{ ssl_file_dir_final }}/control-center-security.properties"

# Logrotate Configuration for Prometheus & Alertmanager
control_center_next_gen_logrotate_enabled: true

# Logrotate Parameters for Prometheus
control_center_next_gen_dependency_prometheus_logrotate_config:
  # Size limit for rotation (e.g., "10M", "100M", "1G")
  size: "10M"
  # Number of rotated files to keep
  rotate: 5

# Logrotate Parameters for Alertmanager
control_center_next_gen_dependency_alertmanager_logrotate_config:
  # Size limit for rotation (e.g., "10M", "100M", "1G")
  size: "10M"
  # Number of rotated files to keep
  rotate: 5
