---
- name: Get ClusterId
  command: "{{ binary_base_path }}/bin/kafka-storage random-uuid"
  environment:
    KAFKA_OPTS: "-Xlog:all=error -XX:+IgnoreUnrecognizedVMOptions"
  register: uuid_key
  changed_when: false
  run_once: true

- name: Format Data Directory
  shell: "{{ binary_base_path }}/bin/kafka-storage  format -t={{ clusterid }} -c {{ kafka_controller.config_file }}  --ignore-formatted"
  register: format_meta
  changed_when: format_meta.rc == 0
  vars:
    clusterid: "{{ uuid_key.stdout }}"
