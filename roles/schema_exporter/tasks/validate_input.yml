---
- name: Validate Schema Exporter prerequisites
  assert:
    that:
      - schema_exporters is defined and schema_exporters | length > 0
      - password_encoder_secret is defined and password_encoder_secret != ''
    fail_msg: "Schema exporter requires proper configuration and password_encoder_secret must be defined"

- name: Validate Schema Exporters configuration
  assert:
    that:
      - item.name is defined
      - item.config is defined
      - item.config.schema_registry_endpoint != 'none'
      - item.context_type | default('AUTO') in ['AUTO', 'CUSTOM', 'NONE', 'DEFAULT']
      - item.context_type | default('AUTO') != 'CUSTOM' or (item.context is defined and item.context != '')
    fail_msg: "Schema exporter '{{ item.name | default('unnamed') }}' requires proper configuration with name, config, and remote endpoint. When using CUSTOM contextType, context must be provided."
  loop: "{{ schema_exporters }}"
