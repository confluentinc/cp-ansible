---
- name: Import variables
  import_role:
    name: variables


- name: Validate input configuration
  include_tasks: validate_input.yml
  tags:
    - validate
    - validate_schema_exporter

- name: Wait for Schema Registry to be Ready
  include_tasks: ../common/tasks/schema_registry_operations.yml
  vars:
    operation_name: "Wait for Schema Registry to be Ready"
    request_url: "{{ schema_registry_http_protocol }}://{{ inventory_hostname }}:{{ schema_registry_listener_port }}/subjects"
    method: GET
    expected_status: 200
    result_var: sr_health_check
    request_retries: "{{ schema_registry_retries }}"
    request_delay: 10

- name: Process each Schema Exporter
  include_tasks: process_exporter.yml
  loop: "{{ schema_exporters }}"
  loop_control:
    loop_var: exporter
    index_var: exporter_index
