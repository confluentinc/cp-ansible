---
- name: Wait for USM Agent service to be ready
  uri:
    url: "http://{{ hostvars[inventory_hostname]|confluent.platform.resolve_hostname }}:{{ usm_agent_admin_port }}/healthz"
    status_code: 200
    validate_certs: false
  register: result
  until: result.status == 200
  retries: 30
  delay: 5
  when: not ansible_check_mode
