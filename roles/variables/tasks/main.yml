- name: Validate broker_id and node_id consistency when enable_node_id is true
  assert:
    that:
      - not (broker_id is defined and node_id is defined and broker_id != node_id)
    fail_msg: |
      ERROR: Conflicting broker_id and node_id values detected!
      - enable_node_id is set to true
      When enable_node_id is true and both broker_id and node_id are defined, they must have the same value.
      Please either:
        1. Set broker_id and node_id to the same value, OR
        2. Define only one of them (node_id is preferred when enable_node_id is true), OR
        3. Set enable_node_id to false if using legacy broker_id
    success_msg: "broker_id and node_id consistency check passed for {{ inventory_hostname }}"
  when:
    - enable_node_id | default(false) | bool
    - inventory_hostname in groups.kafka_broker
  tags:
    - validation
    - broker_id_validation

- name: Ensure old and new mTLS variables are consistent
  include_tasks: mtls.yml
