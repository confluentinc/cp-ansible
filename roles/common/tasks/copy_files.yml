---
- name: Create Dirs for Copied Files
  file:
    path: "{{ item.destination_path | dirname }}"
    state: directory
    mode: "{{ item.directory_mode | default('0750') }}"
    owner: "{{user}}"
    group: "{{group}}"
  loop: "{{ copy_files }}"

- name: Copy Files
  when: ansible_os_family != "OS/390"
  copy:
    src: "{{ item.source_path }}"
    dest: "{{ item.destination_path }}"
    mode: "{{ item.file_mode | default('0640') }}"
    owner: "{{user}}"
    group: "{{group}}"
  loop: "{{ copy_files }}"

- name: Copy Files (z/OS)
  when: ansible_os_family == "OS/390"
  ibm.ibm_zos_core.zos_copy:
    src: "{{ item.source_path }}"
    dest: "{{ item.destination_path }}"
    mode: "{{ item.file_mode | default('0640') }}"
    owner: "{{ user }}"
    group: "{{ group }}"
    validate: yes
    backup: yes
    force: yes
    is_binary: "{{ item.is_binary | default(False) }}"
    remote_src: "{{ item.remote_src | default(False) }}"
  loop: "{{ copy_files }}"