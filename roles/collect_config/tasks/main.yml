---
# tasks file for collect_config
#

- name: Set token
  set_fact:
    token: "kafka"

- name: Set token
  set_fact:
    token: "schema-registry"
  when: "'schema_registry' in group_names"

- name: Set token
  set_fact:
    token: "confluent-control-center"
  when: "'control_center' in group_names"

- name: Collect configurations
  find:
    paths: "{{ archive_destination_path if installation_method == 'archive' else '' }}/etc/{{ token }}"
    recurse: no
    patterns: "*"
  register: files_to_copy

- name: Copy files
  fetch:
    src: "{{ item.path }}"
    dest: "/tmp/collection/{{ hostvars['localhost'].tstamp.stdout }}"
  with_items: "{{ files_to_copy.files }}"
