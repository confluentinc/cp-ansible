---
- name: Validate Schema Importer Prerequisites
  assert:
    that:
      - importer_created_by_automation | default(false) | bool or (schema_importer is defined and schema_importer | length > 0)
    fail_msg: "Schema importer requires proper configuration or automation flag set"

- name: Validate individual Schema Importer configurations
  assert:
    that:
      - item.name is defined
      - item.config is defined
      - item.context_type | default('AUTO') in ['AUTO', 'CUSTOM', 'NONE', 'DEFAULT']
      - item.context_type | default('AUTO') != 'CUSTOM' or (item.source_context is defined and item.source_context != '')
    fail_msg: "Schema importer '{{ item.name | default('unnamed') }}' requires proper configuration with name and config. When using CUSTOM context_type, source_context must be provided."
  loop: "{{ schema_importer }}"
  when: not (importer_created_by_automation | default(false) | bool)
