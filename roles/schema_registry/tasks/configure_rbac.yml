---
- name: Configure RBAC for OAuth User
  include_tasks: rbac.yml
  vars:
    sr_user: "{{schema_registry_oauth_principal}}"
  when: rbac_enabled|bool and oauth_enabled|bool

- name: Configure RBAC for LDAP User
  include_tasks: rbac.yml
  vars:
    sr_user: "{{schema_registry_ldap_user}}"
  when:
    - rbac_enabled|bool
    - "'ldap' in auth_mode"

- name: Extract SR Principal from cert
  import_role:
    name: common
    tasks_from: cert_principal_extract.yml
  vars:
    keystore_path: "{{schema_registry_keystore_path}}"
    keystore_storepass: "{{schema_registry_keystore_storepass}}"
    pm_rules: "{{schema_registry_final_properties.get('auth.ssl.principal.mapping.rules','DEFAULT')}}"
  when:
    - rbac_enabled|bool
    - mds_ssl_client_authentication != 'none'

- name: Configure RBAC for mTLS User
  include_tasks: rbac.yml
  vars:
    sr_user: "{{ ks_extracted_principal | urlencode }}"
  when:
    - rbac_enabled|bool
    - mds_ssl_client_authentication != 'none'