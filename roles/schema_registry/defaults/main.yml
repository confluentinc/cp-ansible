---
# More schema_registry variables are defined in the variables role

### Boolean to reconfigure Schema Registry's logging with RollingFileAppender and log cleanup
schema_registry_custom_log4j2: "{{ custom_log4j2 }}"

### Root logger level within Schema Registry's log4j2 config. Only honored if schema_registry_custom_log4j2: true
schema_registry_log4j2_root_logger_level: "INFO"

### Root logger appender within Schema Registry's log4j2 config. Only honored if schema_registry_custom_log4j2: true
schema_registry_log4j2_root_appenders:
  - stdout
  - file

### Max number of log files generated by Schema Registry. Only honored if schema_registry_custom_log4j2: true
schema_registry_max_log_files: 10

### Max size of a log file generated by Schema Registry. Only honored if schema_registry_custom_log4j2: true
schema_registry_log_file_size: 100MB

### List of loggers to redact. This is specified alongside the appenderRefs to be used in redactor definition.
schema_registry_logredactor_logger_specs_list:
  - { logger_name: "Root", appenderRefs: "file" }

schema_registry_oauth_urls_list: "{{ [oauth_token_uri, oauth_jwks_uri] | select('!=', none) | join(',') }}"

schema_registry_oauth_urls_java_arg: "{% if not whitelist_explicit_oauth_urls|bool %}-Dorg.apache.kafka.sasl.oauthbearer.allowed.urls=*{% else %}-Dorg.apache.kafka.sasl.oauthbearer.allowed.urls={{schema_registry_oauth_urls_list}}{% endif %}"

schema_registry_java_args:
  - "{% if schema_registry_ssl_enabled|bool %}-Djdk.tls.ephemeralDHKeySize=2048{% endif %}"
  - "{% if schema_registry_jolokia_enabled|bool %}-javaagent:{{jolokia_jar_path}}=config={{schema_registry_jolokia_config}}{% endif %}"
  - "{% if schema_registry_jmxexporter_enabled|bool %}-javaagent:{{jmxexporter_jar_path}}={{schema_registry_jmxexporter_port}}:{{schema_registry_jmxexporter_config_path}}{% endif %}"
  - "{% if schema_registry_authentication_type == 'basic' %}-Djava.security.auth.login.config={{schema_registry.jaas_file}}{% endif %}"
  - "{% if kerberos_client_config_file_dest != '/etc/krb5.conf' %}-Djava.security.krb5.conf={{kerberos_client_config_file_dest}}{% endif %}"
  - "{% if schema_registry_oauth_urls_list != '' %}{{ schema_registry_oauth_urls_java_arg }}{% endif %}"

### Custom Java Args to add to the Schema Registry Process
schema_registry_custom_java_args: ""

schema_registry_final_java_args: "{{ schema_registry_java_args + [ schema_registry_custom_java_args ] }}"

# For following dictionaries, Key/Value Pairs with empty values will not be written into override.conf

### Overrides to the Service Section of Schema Registry Systemd File. This variable is a dictionary.
schema_registry_service_overrides:
  LimitNOFILE: 100000
  User: "{{ schema_registry_user if schema_registry_user != schema_registry_default_user else '' }}"
  Group: "{{ schema_registry_group if schema_registry_group != schema_registry_default_group else '' }}"
  ExecStart: "{% if installation_method == 'archive' %}{{ schema_registry.server_start_file }} {{ schema_registry.config_file }}{% endif %}"

### Environment Variables to be added to the Schema Registry Service. This variable is a dictionary.
schema_registry_service_environment_overrides:
  SCHEMA_REGISTRY_HEAP_OPTS: "-Xms1g -Xmx1g -XX:MetaspaceSize=96m -XX:+UseG1GC -XX:MaxGCPauseMillis=20 -XX:InitiatingHeapOccupancyPercent=35 -XX:G1HeapRegionSize=16M -XX:MinMetaspaceFreeRatio=50 -XX:MaxMetaspaceFreeRatio=80"
  SCHEMA_REGISTRY_OPTS: "{{ schema_registry_final_java_args | confluent.platform.java_arg_build_out }}"
  # Remove trailing slash if there is one
  SCHEMA_REGISTRY_LOG4J_OPTS: "{% if schema_registry_custom_log4j2|bool %}-Dlog4j2.configurationFile=file:{{ schema_registry.log4j_file }}{% endif %}"
  LOG_DIR: "{{ schema_registry_log_dir|regex_replace('\\/$', '') }}"
  CONFLUENT_SECURITY_MASTER_KEY: "{% if schema_registry_secrets_protection_enabled|bool %}{{secrets_protection_masterkey}}{% endif %}"

### Overrides to the Unit Section of Schema Registry Systemd File. This variable is a dictionary.
schema_registry_service_unit_overrides:

### Time in seconds to wait before starting Schema Registry Health Checks.
schema_registry_health_check_delay: 15

schema_registry_secrets_protection_file: "{{ ssl_file_dir_final }}/schema-registry-security.properties"
